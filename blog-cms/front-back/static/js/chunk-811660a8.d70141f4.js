(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-811660a8"],{4020:function(e,t,r){"use strict";r("d3b7");var o=r("bc3a"),a=r.n(o),i=r("323e"),n=r.n(i),l=(r("a5d8"),r("5c96")),s=a.a.create({baseURL:"http://81.68.124.95:8090/admin/",timeout:5e3}),c=a.a.CancelToken;s.interceptors.request.use((function(e){var t=window.localStorage.getItem("user")||"{}",r=JSON.parse(t);if("{}"!==t&&"ROLE_admin"!==r.role&&"get"!==e.method)return e.cancelToken=new c((function(e){e("演示模式，不允许操作")})),e;n.a.start();var o=window.localStorage.getItem("token");return o&&(e.headers.Authorization=o),e}),(function(e){return console.info(e),Promise.reject(e)})),s.interceptors.response.use((function(e){n.a.done();var t=e.data;if(200!==t.code){var r=t.msg||"Error";return l["Message"].error(r),Promise.reject(new Error(r))}return t}),(function(e){return console.info(e),l["Message"].error(e.message),Promise.reject(e)})),t["a"]=s},"864d":function(e,t,r){"use strict";r.d(t,"d",(function(){return i})),r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return l})),r.d(t,"e",(function(){return s})),r.d(t,"h",(function(){return c})),r.d(t,"g",(function(){return m})),r.d(t,"i",(function(){return u})),r.d(t,"b",(function(){return f})),r.d(t,"f",(function(){return d}));var o=r("5530"),a=r("4020");function i(e){return Object(a["a"])({url:"blogs",method:"GET",params:Object(o["a"])({},e)})}function n(e){return Object(a["a"])({url:"blog",method:"DELETE",params:{id:e}})}function l(){return Object(a["a"])({url:"categoryAndTag",method:"GET"})}function s(e){return Object(a["a"])({url:"blog",method:"POST",data:Object(o["a"])({},e)})}function c(e,t){return Object(a["a"])({url:"blog/top",method:"PUT",params:{id:e,top:t}})}function m(e,t){return Object(a["a"])({url:"blog/recommend",method:"PUT",params:{id:e,recommend:t}})}function u(e,t){return Object(a["a"])({url:"blog/".concat(e,"/visibility"),method:"PUT",data:Object(o["a"])({},t)})}function f(e){return Object(a["a"])({url:"blog",method:"GET",params:{id:e}})}function d(e){return Object(a["a"])({url:"blog",method:"PUT",data:Object(o["a"])({},e)})}},"956d":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.formRules,"label-position":"top"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[r("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"文章首图URL",prop:"firstPicture"}},[r("el-input",{attrs:{placeholder:"文章首图，用于随机文章展示"},model:{value:e.form.firstPicture,callback:function(t){e.$set(e.form,"firstPicture",t)},expression:"form.firstPicture"}})],1)],1)],1),r("el-form-item",{attrs:{label:"文章描述",prop:"description"}},[r("mavon-editor",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),r("el-form-item",{attrs:{label:"文章正文",prop:"content"}},[r("mavon-editor",{model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"分类",prop:"cate"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分类（输入可添加新分类）","allow-create":!0,filterable:!0},model:{value:e.form.cate,callback:function(t){e.$set(e.form,"cate",t)},expression:"form.cate"}},e._l(e.categoryList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"标签",prop:"tagList"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择标签（输入可添加新标签）","allow-create":!0,filterable:!0,multiple:!0},model:{value:e.form.tagList,callback:function(t){e.$set(e.form,"tagList",t)},expression:"form.tagList"}},e._l(e.tagList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"字数",prop:"words"}},[r("el-input",{attrs:{placeholder:"请输入文章字数（自动计算阅读时长）",type:"number"},model:{value:e.form.words,callback:function(t){e.$set(e.form,"words",t)},expression:"form.words"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"阅读时长(分钟)",prop:"readTime"}},[r("el-input",{attrs:{placeholder:"请输入阅读时长（可选）默认 Math.round(字数 / 200)",type:"number"},model:{value:e.form.readTime,callback:function(t){e.$set(e.form,"readTime",t)},expression:"form.readTime"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"浏览次数",prop:"views"}},[r("el-input",{attrs:{placeholder:"请输入文章字数（可选）默认为 0",type:"number"},model:{value:e.form.views,callback:function(t){e.$set(e.form,"views",t)},expression:"form.views"}})],1)],1)],1),r("el-form-item",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("保存")])],1)],1),r("el-dialog",{attrs:{title:"博客可见性",width:"30%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{"label-width":"50px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[r("el-radio",{attrs:{label:1}},[e._v("公开")]),r("el-radio",{attrs:{label:2}},[e._v("私密")]),r("el-radio",{attrs:{label:3}},[e._v("密码保护")])],1)],1),3===e.radio?r("el-form-item",{attrs:{label:"密码"}},[r("el-input",{model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),2!==e.radio?r("el-form-item",[r("el-row",[r("el-col",{attrs:{span:6}},[r("el-switch",{attrs:{"active-text":"赞赏"},model:{value:e.form.appreciation,callback:function(t){e.$set(e.form,"appreciation",t)},expression:"form.appreciation"}})],1),r("el-col",{attrs:{span:6}},[r("el-switch",{attrs:{"active-text":"推荐"},model:{value:e.form.recommend,callback:function(t){e.$set(e.form,"recommend",t)},expression:"form.recommend"}})],1),r("el-col",{attrs:{span:6}},[r("el-switch",{attrs:{"active-text":"评论"},model:{value:e.form.commentEnabled,callback:function(t){e.$set(e.form,"commentEnabled",t)},expression:"form.commentEnabled"}})],1),r("el-col",{attrs:{span:6}},[r("el-switch",{attrs:{"active-text":"置顶"},model:{value:e.form.top,callback:function(t){e.$set(e.form,"top",t)},expression:"form.top"}})],1)],1)],1):e._e()],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")])],1)],1)],1)},a=[],i=(r("d3b7"),r("159b"),r("6350")),n=r("864d"),l={name:"WriteBlog",components:{Breadcrumb:i["a"]},data:function(){return{categoryList:[],tagList:[],dialogVisible:!1,radio:1,form:{title:"",firstPicture:"",description:"",content:"",cate:null,tagList:[],words:null,readTime:null,views:0,appreciation:!1,recommend:!1,commentEnabled:!1,top:!1,published:!1,password:""},formRules:{title:[{required:!0,message:"请输入标题",trigger:"change"}],firstPicture:[{required:!0,message:"请输入首图链接",trigger:"change"}],cate:[{required:!0,message:"请选择分类",trigger:"change"}],tagList:[{required:!0,message:"请选择标签",trigger:"change"}],words:[{required:!0,message:"请输入文章字数",trigger:"change"}]}}},watch:{"form.words":function(e){this.form.readTime=e?Math.round(e/200):null}},created:function(){this.getData(),this.$route.params.id&&this.getBlog(this.$route.params.id)},methods:{getData:function(){var e=this;Object(n["c"])().then((function(t){e.categoryList=t.data.categories,e.tagList=t.data.tags}))},getBlog:function(e){var t=this;Object(n["b"])(e).then((function(e){t.computeCategoryAndTag(e.data),t.form=e.data,t.radio=t.form.published?""!==t.form.password?3:1:2}))},computeCategoryAndTag:function(e){e.cate=e.category.id,e.tagList=[],e.tags.forEach((function(t){e.tagList.push(t.id)}))},submit:function(){var e=this;if(3===this.radio&&(""===this.form.password||null===this.form.password))return this.msgError("密码保护模式必须填写密码！");this.$refs.formRef.validate((function(t){if(!t)return e.dialogVisible=!1,e.msgError("请填写必要的表单项");2===e.radio?(e.form.appreciation=!1,e.form.recommend=!1,e.form.commentEnabled=!1,e.form.top=!1,e.form.published=!1):e.form.published=!0,3!==e.radio&&(e.form.password=""),e.$route.params.id?(e.form.category=null,e.form.tags=null,Object(n["f"])(e.form).then((function(t){e.msgSuccess(t.msg),e.$router.push("/blog/list")}))):Object(n["e"])(e.form).then((function(t){e.msgSuccess(t.msg),e.$router.push("/blog/list")}))}))}}},s=l,c=r("2877"),m=Object(c["a"])(s,o,a,!1,null,"55da4a1a",null);t["default"]=m.exports}}]);